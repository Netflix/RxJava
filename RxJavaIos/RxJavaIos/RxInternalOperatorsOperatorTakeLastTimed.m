//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/kgalligan/devel-doppl/RxJava/src/main/java/rx/internal/operators/OperatorTakeLastTimed.java
//

#include "J2ObjC_source.h"
#include "RxInternalOperatorsBackpressureUtils.h"
#include "RxInternalOperatorsNotificationLite.h"
#include "RxInternalOperatorsOperatorTakeLastTimed.h"
#include "RxProducer.h"
#include "RxScheduler.h"
#include "RxSubscriber.h"
#include "java/lang/IndexOutOfBoundsException.h"
#include "java/lang/Long.h"
#include "java/util/ArrayDeque.h"
#include "java/util/concurrent/TimeUnit.h"
#include "java/util/concurrent/atomic/AtomicLong.h"

@interface RxInternalOperatorsOperatorTakeLastTimed_$1 : NSObject < RxProducer > {
 @public
  RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber *val$parent_;
}

- (void)requestWithLong:(jlong)n;

- (instancetype)initWithRxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber:(RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber *)capture$0;

@end

J2OBJC_EMPTY_STATIC_INIT(RxInternalOperatorsOperatorTakeLastTimed_$1)

J2OBJC_FIELD_SETTER(RxInternalOperatorsOperatorTakeLastTimed_$1, val$parent_, RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber *)

__attribute__((unused)) static void RxInternalOperatorsOperatorTakeLastTimed_$1_initWithRxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber_(RxInternalOperatorsOperatorTakeLastTimed_$1 *self, RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber *capture$0);

__attribute__((unused)) static RxInternalOperatorsOperatorTakeLastTimed_$1 *new_RxInternalOperatorsOperatorTakeLastTimed_$1_initWithRxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber_(RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber *capture$0) NS_RETURNS_RETAINED;

__attribute__((unused)) static RxInternalOperatorsOperatorTakeLastTimed_$1 *create_RxInternalOperatorsOperatorTakeLastTimed_$1_initWithRxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber_(RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber *capture$0);

@implementation RxInternalOperatorsOperatorTakeLastTimed

- (instancetype)initWithLong:(jlong)time
withJavaUtilConcurrentTimeUnit:(JavaUtilConcurrentTimeUnit *)unit
             withRxScheduler:(RxScheduler *)scheduler {
  RxInternalOperatorsOperatorTakeLastTimed_initWithLong_withJavaUtilConcurrentTimeUnit_withRxScheduler_(self, time, unit, scheduler);
  return self;
}

- (instancetype)initWithInt:(jint)count
                   withLong:(jlong)time
withJavaUtilConcurrentTimeUnit:(JavaUtilConcurrentTimeUnit *)unit
            withRxScheduler:(RxScheduler *)scheduler {
  RxInternalOperatorsOperatorTakeLastTimed_initWithInt_withLong_withJavaUtilConcurrentTimeUnit_withRxScheduler_(self, count, time, unit, scheduler);
  return self;
}

- (RxSubscriber *)callWithId:(RxSubscriber *)subscriber {
  RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber *parent = create_RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber_initWithRxSubscriber_withInt_withLong_withRxScheduler_(subscriber, count_, ageMillis_, scheduler_);
  [((RxSubscriber *) nil_chk(subscriber)) addWithRxSubscription:parent];
  [subscriber setProducerWithRxProducer:create_RxInternalOperatorsOperatorTakeLastTimed_$1_initWithRxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber_(parent)];
  return parent;
}

- (void)dealloc {
  RELEASE_(scheduler_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, -1, -1, -1 },
    { NULL, NULL, 0x1, -1, 1, -1, -1, -1, -1 },
    { NULL, "LRxSubscriber;", 0x1, 2, 3, -1, 4, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  methods[0].selector = @selector(initWithLong:withJavaUtilConcurrentTimeUnit:withRxScheduler:);
  methods[1].selector = @selector(initWithInt:withLong:withJavaUtilConcurrentTimeUnit:withRxScheduler:);
  methods[2].selector = @selector(callWithId:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "ageMillis_", "J", .constantValue.asLong = 0, 0x10, -1, -1, -1, -1 },
    { "scheduler_", "LRxScheduler;", .constantValue.asLong = 0, 0x10, -1, -1, -1, -1 },
    { "count_", "I", .constantValue.asLong = 0, 0x10, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "JLJavaUtilConcurrentTimeUnit;LRxScheduler;", "IJLJavaUtilConcurrentTimeUnit;LRxScheduler;", "call", "LRxSubscriber;", "(Lrx/Subscriber<-TT;>;)Lrx/Subscriber<-TT;>;", "LRxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber;", "<T:Ljava/lang/Object;>Ljava/lang/Object;Lrx/Observable$Operator<TT;TT;>;" };
  static const J2ObjcClassInfo _RxInternalOperatorsOperatorTakeLastTimed = { "OperatorTakeLastTimed", "rx.internal.operators", ptrTable, methods, fields, 7, 0x11, 3, 3, -1, 5, -1, 6, -1 };
  return &_RxInternalOperatorsOperatorTakeLastTimed;
}

@end

void RxInternalOperatorsOperatorTakeLastTimed_initWithLong_withJavaUtilConcurrentTimeUnit_withRxScheduler_(RxInternalOperatorsOperatorTakeLastTimed *self, jlong time, JavaUtilConcurrentTimeUnit *unit, RxScheduler *scheduler) {
  NSObject_init(self);
  self->ageMillis_ = [((JavaUtilConcurrentTimeUnit *) nil_chk(unit)) toMillisWithLong:time];
  JreStrongAssign(&self->scheduler_, scheduler);
  self->count_ = -1;
}

RxInternalOperatorsOperatorTakeLastTimed *new_RxInternalOperatorsOperatorTakeLastTimed_initWithLong_withJavaUtilConcurrentTimeUnit_withRxScheduler_(jlong time, JavaUtilConcurrentTimeUnit *unit, RxScheduler *scheduler) {
  J2OBJC_NEW_IMPL(RxInternalOperatorsOperatorTakeLastTimed, initWithLong_withJavaUtilConcurrentTimeUnit_withRxScheduler_, time, unit, scheduler)
}

RxInternalOperatorsOperatorTakeLastTimed *create_RxInternalOperatorsOperatorTakeLastTimed_initWithLong_withJavaUtilConcurrentTimeUnit_withRxScheduler_(jlong time, JavaUtilConcurrentTimeUnit *unit, RxScheduler *scheduler) {
  J2OBJC_CREATE_IMPL(RxInternalOperatorsOperatorTakeLastTimed, initWithLong_withJavaUtilConcurrentTimeUnit_withRxScheduler_, time, unit, scheduler)
}

void RxInternalOperatorsOperatorTakeLastTimed_initWithInt_withLong_withJavaUtilConcurrentTimeUnit_withRxScheduler_(RxInternalOperatorsOperatorTakeLastTimed *self, jint count, jlong time, JavaUtilConcurrentTimeUnit *unit, RxScheduler *scheduler) {
  NSObject_init(self);
  if (count < 0) {
    @throw create_JavaLangIndexOutOfBoundsException_initWithNSString_(@"count could not be negative");
  }
  self->ageMillis_ = [((JavaUtilConcurrentTimeUnit *) nil_chk(unit)) toMillisWithLong:time];
  JreStrongAssign(&self->scheduler_, scheduler);
  self->count_ = count;
}

RxInternalOperatorsOperatorTakeLastTimed *new_RxInternalOperatorsOperatorTakeLastTimed_initWithInt_withLong_withJavaUtilConcurrentTimeUnit_withRxScheduler_(jint count, jlong time, JavaUtilConcurrentTimeUnit *unit, RxScheduler *scheduler) {
  J2OBJC_NEW_IMPL(RxInternalOperatorsOperatorTakeLastTimed, initWithInt_withLong_withJavaUtilConcurrentTimeUnit_withRxScheduler_, count, time, unit, scheduler)
}

RxInternalOperatorsOperatorTakeLastTimed *create_RxInternalOperatorsOperatorTakeLastTimed_initWithInt_withLong_withJavaUtilConcurrentTimeUnit_withRxScheduler_(jint count, jlong time, JavaUtilConcurrentTimeUnit *unit, RxScheduler *scheduler) {
  J2OBJC_CREATE_IMPL(RxInternalOperatorsOperatorTakeLastTimed, initWithInt_withLong_withJavaUtilConcurrentTimeUnit_withRxScheduler_, count, time, unit, scheduler)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(RxInternalOperatorsOperatorTakeLastTimed)

@implementation RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber

- (instancetype)initWithRxSubscriber:(RxSubscriber *)actual
                             withInt:(jint)count
                            withLong:(jlong)ageMillis
                     withRxScheduler:(RxScheduler *)scheduler {
  RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber_initWithRxSubscriber_withInt_withLong_withRxScheduler_(self, actual, count, ageMillis, scheduler);
  return self;
}

- (void)onNextWithId:(id)t {
  if (count_ != 0) {
    jlong now = [((RxScheduler *) nil_chk(scheduler_)) now];
    if ([((JavaUtilArrayDeque *) nil_chk(queue_)) size] == count_) {
      [queue_ poll];
      [((JavaUtilArrayDeque *) nil_chk(queueTimes_)) poll];
    }
    [self evictOldWithLong:now];
    [queue_ offerWithId:RxInternalOperatorsNotificationLite_nextWithId_(t)];
    [((JavaUtilArrayDeque *) nil_chk(queueTimes_)) offerWithId:JavaLangLong_valueOfWithLong_(now)];
  }
}

- (void)evictOldWithLong:(jlong)now {
  jlong minTime = now - ageMillis_;
  for (; ; ) {
    JavaLangLong *time = [((JavaUtilArrayDeque *) nil_chk(queueTimes_)) peek];
    if (time == nil || [time longLongValue] >= minTime) {
      break;
    }
    [((JavaUtilArrayDeque *) nil_chk(queue_)) poll];
    [queueTimes_ poll];
  }
}

- (void)onErrorWithNSException:(NSException *)e {
  [((JavaUtilArrayDeque *) nil_chk(queue_)) clear];
  [((JavaUtilArrayDeque *) nil_chk(queueTimes_)) clear];
  [((RxSubscriber *) nil_chk(actual_)) onErrorWithNSException:e];
}

- (void)onCompleted {
  [self evictOldWithLong:[((RxScheduler *) nil_chk(scheduler_)) now]];
  [((JavaUtilArrayDeque *) nil_chk(queueTimes_)) clear];
  RxInternalOperatorsBackpressureUtils_postCompleteDoneWithJavaUtilConcurrentAtomicAtomicLong_withJavaUtilQueue_withRxSubscriber_withRxFunctionsFunc1_(requested_TakeLastTimedSubscriber_, queue_, actual_, self);
}

- (id)callWithId:(id)t {
  return RxInternalOperatorsNotificationLite_getValueWithId_(t);
}

- (void)requestMoreWithLong:(jlong)n {
  RxInternalOperatorsBackpressureUtils_postCompleteRequestWithJavaUtilConcurrentAtomicAtomicLong_withLong_withJavaUtilQueue_withRxSubscriber_withRxFunctionsFunc1_(requested_TakeLastTimedSubscriber_, n, queue_, actual_, self);
}

- (void)dealloc {
  JreCheckFinalize(self, [RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber class]);
  RELEASE_(actual_);
  RELEASE_(scheduler_);
  RELEASE_(requested_TakeLastTimedSubscriber_);
  RELEASE_(queue_);
  RELEASE_(queueTimes_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, 1, -1, -1 },
    { NULL, "V", 0x1, 2, 3, -1, 4, -1, -1 },
    { NULL, "V", 0x4, 5, 6, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 7, 8, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LNSObject;", 0x1, 9, 3, -1, 10, -1, -1 },
    { NULL, "V", 0x0, 11, 6, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  methods[0].selector = @selector(initWithRxSubscriber:withInt:withLong:withRxScheduler:);
  methods[1].selector = @selector(onNextWithId:);
  methods[2].selector = @selector(evictOldWithLong:);
  methods[3].selector = @selector(onErrorWithNSException:);
  methods[4].selector = @selector(onCompleted);
  methods[5].selector = @selector(callWithId:);
  methods[6].selector = @selector(requestMoreWithLong:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "actual_", "LRxSubscriber;", .constantValue.asLong = 0, 0x10, -1, -1, 12, -1 },
    { "ageMillis_", "J", .constantValue.asLong = 0, 0x10, -1, -1, -1, -1 },
    { "scheduler_", "LRxScheduler;", .constantValue.asLong = 0, 0x10, -1, -1, -1, -1 },
    { "count_", "I", .constantValue.asLong = 0, 0x10, -1, -1, -1, -1 },
    { "requested_TakeLastTimedSubscriber_", "LJavaUtilConcurrentAtomicAtomicLong;", .constantValue.asLong = 0, 0x10, 13, -1, -1, -1 },
    { "queue_", "LJavaUtilArrayDeque;", .constantValue.asLong = 0, 0x10, -1, -1, 14, -1 },
    { "queueTimes_", "LJavaUtilArrayDeque;", .constantValue.asLong = 0, 0x10, -1, -1, 15, -1 },
  };
  static const void *ptrTable[] = { "LRxSubscriber;IJLRxScheduler;", "(Lrx/Subscriber<-TT;>;IJLrx/Scheduler;)V", "onNext", "LNSObject;", "(TT;)V", "evictOld", "J", "onError", "LNSException;", "call", "(Ljava/lang/Object;)TT;", "requestMore", "Lrx/Subscriber<-TT;>;", "requested", "Ljava/util/ArrayDeque<Ljava/lang/Object;>;", "Ljava/util/ArrayDeque<Ljava/lang/Long;>;", "LRxInternalOperatorsOperatorTakeLastTimed;", "<T:Ljava/lang/Object;>Lrx/Subscriber<TT;>;Lrx/functions/Func1<Ljava/lang/Object;TT;>;" };
  static const J2ObjcClassInfo _RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber = { "TakeLastTimedSubscriber", "rx.internal.operators", ptrTable, methods, fields, 7, 0x18, 7, 7, 16, -1, -1, 17, -1 };
  return &_RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber;
}

@end

void RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber_initWithRxSubscriber_withInt_withLong_withRxScheduler_(RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber *self, RxSubscriber *actual, jint count, jlong ageMillis, RxScheduler *scheduler) {
  RxSubscriber_init(self);
  JreStrongAssign(&self->actual_, actual);
  self->count_ = count;
  self->ageMillis_ = ageMillis;
  JreStrongAssign(&self->scheduler_, scheduler);
  JreStrongAssignAndConsume(&self->requested_TakeLastTimedSubscriber_, new_JavaUtilConcurrentAtomicAtomicLong_init());
  JreStrongAssignAndConsume(&self->queue_, new_JavaUtilArrayDeque_init());
  JreStrongAssignAndConsume(&self->queueTimes_, new_JavaUtilArrayDeque_init());
}

RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber *new_RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber_initWithRxSubscriber_withInt_withLong_withRxScheduler_(RxSubscriber *actual, jint count, jlong ageMillis, RxScheduler *scheduler) {
  J2OBJC_NEW_IMPL(RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber, initWithRxSubscriber_withInt_withLong_withRxScheduler_, actual, count, ageMillis, scheduler)
}

RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber *create_RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber_initWithRxSubscriber_withInt_withLong_withRxScheduler_(RxSubscriber *actual, jint count, jlong ageMillis, RxScheduler *scheduler) {
  J2OBJC_CREATE_IMPL(RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber, initWithRxSubscriber_withInt_withLong_withRxScheduler_, actual, count, ageMillis, scheduler)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber)

@implementation RxInternalOperatorsOperatorTakeLastTimed_$1

- (void)requestWithLong:(jlong)n {
  [((RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber *) nil_chk(val$parent_)) requestMoreWithLong:n];
}

- (instancetype)initWithRxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber:(RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber *)capture$0 {
  RxInternalOperatorsOperatorTakeLastTimed_$1_initWithRxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber_(self, capture$0);
  return self;
}

- (void)dealloc {
  RELEASE_(val$parent_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, "V", 0x1, 0, 1, -1, -1, -1, -1 },
    { NULL, NULL, 0x0, -1, 2, -1, 3, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  methods[0].selector = @selector(requestWithLong:);
  methods[1].selector = @selector(initWithRxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "val$parent_", "LRxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber;", .constantValue.asLong = 0, 0x1012, -1, -1, 4, -1 },
  };
  static const void *ptrTable[] = { "request", "J", "LRxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber;", "(Lrx/internal/operators/OperatorTakeLastTimed$TakeLastTimedSubscriber<TT;>;)V", "Lrx/internal/operators/OperatorTakeLastTimed$TakeLastTimedSubscriber<TT;>;", "LRxInternalOperatorsOperatorTakeLastTimed;", "callWithId:" };
  static const J2ObjcClassInfo _RxInternalOperatorsOperatorTakeLastTimed_$1 = { "", "rx.internal.operators", ptrTable, methods, fields, 7, 0x8008, 2, 1, 5, -1, 6, -1, -1 };
  return &_RxInternalOperatorsOperatorTakeLastTimed_$1;
}

@end

void RxInternalOperatorsOperatorTakeLastTimed_$1_initWithRxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber_(RxInternalOperatorsOperatorTakeLastTimed_$1 *self, RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber *capture$0) {
  JreStrongAssign(&self->val$parent_, capture$0);
  NSObject_init(self);
}

RxInternalOperatorsOperatorTakeLastTimed_$1 *new_RxInternalOperatorsOperatorTakeLastTimed_$1_initWithRxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber_(RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber *capture$0) {
  J2OBJC_NEW_IMPL(RxInternalOperatorsOperatorTakeLastTimed_$1, initWithRxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber_, capture$0)
}

RxInternalOperatorsOperatorTakeLastTimed_$1 *create_RxInternalOperatorsOperatorTakeLastTimed_$1_initWithRxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber_(RxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber *capture$0) {
  J2OBJC_CREATE_IMPL(RxInternalOperatorsOperatorTakeLastTimed_$1, initWithRxInternalOperatorsOperatorTakeLastTimed_TakeLastTimedSubscriber_, capture$0)
}
